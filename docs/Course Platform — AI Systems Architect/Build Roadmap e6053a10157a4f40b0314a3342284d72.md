# Build Roadmap

<aside>
âœ…

**Status:** Generated â€” 24 Dec 2025

</aside>

## Roadmap Overview

| Module | Name | Dependencies | Effort | Complexity |
| --- | --- | --- | --- | --- |
| 1 | Foundation & Auth | None | 2-3 days | Moderate |
| 2 | Course Content CMS | Module 1 | 2-3 days | Moderate |
| 3 | Video Integration (Mux) | Module 2 | 1-2 days | Simple |
| 4 | Payments & Access Control | Module 1 | 2-3 days | Complex |
| 5 | Progress & Engagement | Modules 2, 4 | 2 days | Moderate |
| 6 | Email System | Modules 1, 4, 5 | 2-3 days | Moderate |
| 7 | Admin Dashboard | All above | 2 days | Moderate |
| 8 | Polish & Launch | All above | 1-2 days | Simple |

**Total Estimate:** 14-20 days (~3-4 weeks)

---

## Dependency Diagram

```
Module 1: Foundation & Auth
â”œâ”€â”€ Module 2: Course Content CMS (depends on 1)
â”‚   â””â”€â”€ Module 3: Video Integration (depends on 2)
â”œâ”€â”€ Module 4: Payments & Access Control (depends on 1)
â”‚   â””â”€â”€ Module 5: Progress & Engagement (depends on 2, 4)
â”‚       â””â”€â”€ Module 6: Email System (depends on 1, 4, 5)
â””â”€â”€ Module 7: Admin Dashboard (depends on all above)
    â””â”€â”€ Module 8: Polish & Launch (depends on all)
```

---

## Critical Path

**Longest chain:** 1 â†’ 2 â†’ 3 â†’ 5 â†’ 6 â†’ 7 â†’ 8

**Blocking modules:**

- Module 1 blocks everything
- Module 4 blocks access control (soft locks, paywall)
- Module 5 blocks email triggers (completion events)

**Parallelisation opportunity:** After Module 1, Modules 2 and 4 can be built in parallel.

---

## Module Briefs

---

## Module 1: Foundation & Auth

**Core Problem:** Establish the database, authentication, and basic app structure that everything else builds on.

**Dependencies:** None

**Estimated Effort:** 2-3 days

### Key Flows

- User visits site â†’ Sees landing/login â†’ Signs up (email or Google) â†’ Lands on onboarding
- User completes onboarding â†’ Data saved â†’ Redirected to dashboard
- Returning user â†’ Logs in â†’ Session restored â†’ Dashboard

### Schema Areas

- `User`: Created with role, onboarding fields
- `Account`, `Session`, `VerificationToken`: NextAuth standard tables
- `Event`: First events tracked (signup_started, signup_completed, onboarding_completed)

### What's Included

*From Master Spec 2.1:*

- Sign up / Log in with email + password
- Google OAuth provider
- Guided onboarding flow (name, userType, buildGoal, experienceLevel)
- Onboarding complete flag + redirect to dashboard
- Admin role on User model
- Protected route middleware

### What's NOT Included

- Subscription logic (Module 4)
- Course content display (Module 2)
- Email sending (Module 6)

### Success Criteria

- [ ]  User can sign up with email/password
- [ ]  User can sign up with Google OAuth
- [ ]  Onboarding flow captures all 4 fields
- [ ]  Incomplete onboarding shows reminder on next login
- [ ]  Admin user can access /admin routes
- [ ]  Non-admin redirected from /admin

### Edge Cases & Error States

- **OAuth failure:** Show fallback to email/password with error message
- **Duplicate email:** "Account already exists" â€” offer login
- **Incomplete onboarding:** Persist partial data, remind on next login

### ðŸ§ª QA Testing Criteria

**Complexity:** Moderate

**Core Tests:**

- [ ]  Sign up with email â†’ Account created, session active
- [ ]  Sign up with Google â†’ Account linked, session active
- [ ]  Complete onboarding â†’ All fields saved, redirected to dashboard
- [ ]  Skip onboarding â†’ Reminder shown on next login
- [ ]  Login with existing account â†’ Session restored
- [ ]  Access /admin as USER â†’ Redirected to dashboard

**Edge Cases:**

- [ ]  Sign up with existing email â†’ Error shown, redirect to login
- [ ]  Google OAuth cancelled â†’ Return to login with message
- [ ]  Invalid password format â†’ Validation error shown

---

## Module 2: Course Content CMS

**Core Problem:** Enable admin to create and manage course structure (modules, lessons, assets) and display content to users.

**Dependencies:** Module 1

**Estimated Effort:** 2-3 days

### Key Flows

- Admin â†’ Creates module â†’ Adds lessons â†’ Uploads assets â†’ Publishes
- User â†’ Views dashboard â†’ Sees modules â†’ Clicks lesson â†’ Views content
- Admin â†’ Reorders lessons â†’ Changes reflected in user view

### Schema Areas

- `Module`: CRUD, ordering, published state
- `Lesson`: CRUD, ordering, content (TipTap JSON), isFree flag
- `Asset`: File upload to Vercel Blob, attach to lesson

### What's Included

*From Master Spec 2.3:*

- Course dashboard showing all modules
- Module view with lesson list
- Lesson view with rich text content
- Downloadable assets display
- Admin CMS: CRUD for modules, lessons, assets
- Drag-drop reordering
- Preview before publish
- Module gating logic (skeleton only â€” enforced in Module 5)

### What's NOT Included

- Video player (Module 3)
- Progress tracking (Module 5)
- Paywall enforcement (Module 4)

### Success Criteria

- [ ]  Admin can create/edit/delete modules
- [ ]  Admin can create/edit/delete lessons within modules
- [ ]  Admin can upload assets to lessons
- [ ]  Admin can reorder modules and lessons
- [ ]  User sees published modules on dashboard
- [ ]  User can view lesson content (text/markdown)
- [ ]  Unpublished content hidden from users

### Edge Cases & Error States

- **Empty module:** Show "No lessons yet" message
- **Asset upload failure:** Show error, allow retry
- **Missing asset:** Hide download button, log error

### ðŸ§ª QA Testing Criteria

**Complexity:** Moderate

**Core Tests:**

- [ ]  Create module â†’ Appears in admin list
- [ ]  Create lesson in module â†’ Appears under module
- [ ]  Upload asset to lesson â†’ Download link works
- [ ]  Publish module â†’ Visible to users
- [ ]  Unpublish module â†’ Hidden from users
- [ ]  Reorder lessons â†’ New order persisted

**Edge Cases:**

- [ ]  Delete module with lessons â†’ Cascade deletes lessons
- [ ]  Upload large file (>10MB) â†’ Appropriate handling
- [ ]  TipTap content with images â†’ Renders correctly

---

## Module 3: Video Integration (Mux)

**Core Problem:** Enable video upload, secure playback, and streaming for course content.

**Dependencies:** Module 2

**Estimated Effort:** 1-2 days

### Key Flows

- Admin â†’ Uploads video â†’ Mux processes â†’ playbackId stored â†’ Video ready
- User â†’ Opens lesson â†’ Signed URL generated â†’ Video plays in Mux Player
- User without access â†’ Sees locked state (no video URL)

### Schema Areas

- `Lesson`: muxAssetId, muxPlaybackId, videoDuration populated

### What's Included

*From Master Spec 2.3 + Tech Stack:*

- Mux direct upload from admin
- Webhook handler for video.asset.ready
- Signed URL generation for playback
- Mux Player component (or native HLS)
- Video 1 = free (isFree flag)

### What's NOT Included

- Partial video progress tracking (deferred)
- Video analytics beyond Mux built-in

### Success Criteria

- [ ]  Admin can upload video to lesson
- [ ]  Upload progress shown
- [ ]  Video ready webhook updates lesson record
- [ ]  User sees video player on lesson page
- [ ]  Signed URLs expire after 1 hour
- [ ]  Free video (Video 1) playable without subscription

### Edge Cases & Error States

- **Upload failure:** Show error, allow retry
- **Video processing delayed:** Show "Processing..." state
- **Playback failure:** "Video unavailable, please try again"

### ðŸ§ª QA Testing Criteria

**Complexity:** Simple

**Core Tests:**

- [ ]  Upload video â†’ Processing state shown
- [ ]  Video ready â†’ Player appears on lesson
- [ ]  Play video â†’ Streams without buffering issues
- [ ]  Signed URL expired â†’ New URL fetched automatically

**Edge Cases:**

- [ ]  Upload cancelled mid-way â†’ Cleanup handled
- [ ]  Very long video (>1hr) â†’ Uploads successfully

---

## Module 4: Payments & Access Control

**Core Problem:** Gate content behind subscription paywall with Stripe integration.

**Dependencies:** Module 1

**Estimated Effort:** 2-3 days

### Key Flows

- User completes Video 1 â†’ Sees paywall â†’ Selects plan â†’ Stripe Checkout â†’ Success â†’ Access granted
- User â†’ Billing page â†’ Views invoices â†’ Updates payment â†’ Cancels subscription
- Payment fails â†’ Soft lock â†’ Banner shown â†’ Update payment â†’ Access restored
- Admin â†’ Overrides access for specific user

### Schema Areas

- `Subscription`: Full CRUD via Stripe webhooks
- `User`: accessOverride field for manual grants

### What's Included

*From Master Spec 2.2:*

- Stripe Checkout (monthly Â£49, annual Â£399)
- Stripe Customer Portal integration
- Webhook handlers: checkout.session.completed, invoice.paid, invoice.payment_failed, customer.subscription.deleted
- Soft lock UI (see structure, content locked)
- In-app billing page (status, invoices, update payment, cancel)
- Access override for admin grants
- 90-day refund eligibility check (derived)

### What's NOT Included

- Email notifications for payment events (Module 6)
- Paywall abandonment tracking (Module 6)

### Success Criteria

- [ ]  User can subscribe via Stripe Checkout (monthly)
- [ ]  User can subscribe via Stripe Checkout (annual)
- [ ]  Successful payment â†’ Subscription created, access granted
- [ ]  User can view billing page with current status
- [ ]  User can update payment method via Customer Portal
- [ ]  User can cancel subscription (access until period end)
- [ ]  Failed payment â†’ Soft lock, banner shown
- [ ]  Admin can override access for user

### Edge Cases & Error States

- **Checkout cancelled:** Return to paywall, no action
- **Webhook failure:** Retry logic, idempotent handlers
- **Double subscription attempt:** Prevent, show existing sub
- **Refund requested:** Manual process, check 90-day window

### ðŸ§ª QA Testing Criteria

**Complexity:** Complex

**Core Tests:**

- [ ]  Subscribe monthly â†’ Subscription active, content unlocked
- [ ]  Subscribe annual â†’ Subscription active, content unlocked
- [ ]  Cancel subscription â†’ Access continues until period end
- [ ]  Period ends after cancel â†’ Access revoked
- [ ]  Update payment method â†’ Card updated in Stripe
- [ ]  View billing page â†’ Shows correct status and invoices

**Edge Cases:**

- [ ]  Payment fails â†’ Status = PAST_DUE, soft lock shown
- [ ]  Update payment after failure â†’ Access restored
- [ ]  Webhook delivered out of order â†’ Handled correctly
- [ ]  User already subscribed clicks subscribe â†’ Shown existing subscription

**Integration Tests:**

- [ ]  Full flow: signup â†’ onboarding â†’ Video 1 â†’ paywall â†’ subscribe â†’ full access
- [ ]  Stripe test mode webhooks fire correctly

---

## Module 5: Progress & Engagement

**Core Problem:** Track user progress through the course and create engagement moments.

**Dependencies:** Module 2, Module 4

**Estimated Effort:** 2 days

### Key Flows

- User â†’ Completes lesson â†’ Marks complete â†’ Progress saved â†’ Dashboard updates
- User â†’ Completes all lessons in module â†’ Module complete â†’ Celebration â†’ Next module unlocked
- User â†’ Returns to course â†’ "Resume where you left off" shown

### Schema Areas

- `LessonProgress`: Track completion per user per lesson
- Derived: Module completion (all lessons complete)

### What's Included

*From Master Spec 2.4:*

- "Mark as complete" button on lessons
- Lesson completion tracking (binary)
- Module progress (X of Y lessons)
- Course progress on dashboard
- Module gating (must complete Module N to unlock N+1)
- "Resume where you left off" highlight
- Celebration moments: confetti, share prompts, unlock animation
- Events: lesson_completed, module_completed, course_completed

### What's NOT Included

- Partial video progress (not in MVP)
- Email notifications for completions (Module 6)

### Success Criteria

- [ ]  User can mark lesson as complete
- [ ]  Lesson progress persists across sessions
- [ ]  Module shows X/Y lessons complete
- [ ]  Dashboard shows overall course progress
- [ ]  Completing all lessons in module â†’ Module marked complete
- [ ]  Module completion triggers celebration (confetti)
- [ ]  Share prompt appears on module completion
- [ ]  Next module unlocks after current complete
- [ ]  Locked modules show locked state
- [ ]  "Continue where you left off" links to next incomplete lesson

### Edge Cases & Error States

- **Rapid clicking "complete":** Debounce, prevent duplicates
- **Module with no lessons:** Skip in progression
- **Already completed lesson:** Toggle allowed, or keep complete

### ðŸ§ª QA Testing Criteria

**Complexity:** Moderate

**Core Tests:**

- [ ]  Mark lesson complete â†’ Progress saved, UI updates
- [ ]  Complete all lessons in module â†’ Module complete, celebration shown
- [ ]  Complete Module 1 â†’ Module 2 unlocked
- [ ]  Return to dashboard â†’ Correct progress shown
- [ ]  Click "Continue" â†’ Goes to next incomplete lesson

**Edge Cases:**

- [ ]  Mark lesson complete while offline â†’ Handled gracefully
- [ ]  Try to access locked module â†’ Redirect or locked message
- [ ]  Complete final module â†’ Course complete event, celebration

---

## Module 6: Email System

**Core Problem:** Send automated emails for engagement, retention, and payment recovery.

**Dependencies:** Module 1, Module 4, Module 5

**Estimated Effort:** 2-3 days

### Key Flows

- User signs up â†’ Welcome email sent immediately
- User completes Video 1, doesn't subscribe â†’ Abandonment sequence (1hr, 24hr, 3 days)
- User completes module â†’ Congratulations email
- User inactive 7 days â†’ Nudge email
- Payment fails â†’ Payment failed email â†’ 3 days later, final warning

### Schema Areas

- `EmailQueue`: Scheduled emails waiting to send
- `EmailLog`: Sent email history
- `User`: marketingOptOut for unsubscribe

### What's Included

*From Master Spec 2.5:*

- Mailgun integration
- All 10 email templates
- Email queue table + cron job processor
- Trigger logic for each email type
- Unsubscribe handling (marketingOptOut)
- Email logs viewable in admin

### What's NOT Included

- Email template editor in admin (use Mailgun dashboard or code)

### Success Criteria

- [ ]  Welcome email sends on signup
- [ ]  Abandonment emails scheduled after Video 1 complete (no sub)
- [ ]  Abandonment emails cancelled if user subscribes
- [ ]  Module complete email sends on completion
- [ ]  Inactive nudge email sends after 7 days
- [ ]  Payment failed email sends immediately
- [ ]  Final warning sends 3 days after first failure
- [ ]  Unsubscribed users don't receive marketing emails
- [ ]  Transactional emails (payment) always send

### Edge Cases & Error States

- **Email send failure:** Log error, retry logic
- **User unsubscribes:** Flag checked before sending
- **Duplicate emails:** Prevent via queue deduplication

### ðŸ§ª QA Testing Criteria

**Complexity:** Moderate

**Core Tests:**

- [ ]  Sign up â†’ Welcome email received
- [ ]  Complete Video 1, no subscribe â†’ Abandonment email 1 at 1hr
- [ ]  Subscribe after Video 1 â†’ Abandonment emails cancelled
- [ ]  Complete module â†’ Congratulations email received
- [ ]  7 days inactive â†’ Nudge email received
- [ ]  Payment fails â†’ Payment failed email received

**Edge Cases:**

- [ ]  Unsubscribe from marketing â†’ No more nudge/abandonment emails
- [ ]  Unsubscribe â†’ Still receives payment failed (transactional)
- [ ]  Email bounces â†’ Logged, no retry loop

**Integration Tests:**

- [ ]  Full abandonment sequence fires at correct times
- [ ]  Cron job processes queue correctly

---

## Module 7: Admin Dashboard

**Core Problem:** Give admin visibility into users, analytics, and override controls.

**Dependencies:** All above modules

**Estimated Effort:** 2 days

### Key Flows

- Admin â†’ Logs in â†’ Sees dashboard with key metrics
- Admin â†’ Views user list â†’ Searches/filters â†’ Views user detail
- Admin â†’ Grants/revokes access override
- Admin â†’ Views email logs for user

### Schema Areas

- `User`: Read for management, accessOverride for overrides
- `Subscription`: Read for status display
- `LessonProgress`: Read for user progress
- `Event`: Aggregated for analytics
- `EmailLog`: Read for email history

### What's Included

*From Master Spec 2.6:*

- Dashboard: User count, active subscribers, MRR, conversion metrics
- User management: List, search, filter by status
- User detail: Progress, subscription status, email logs
- Access override toggle
- Analytics queries from Event table

### What's NOT Included

- Email template editing (use Mailgun)
- Content management (already in Module 2)

### Success Criteria

- [ ]  Dashboard shows user count
- [ ]  Dashboard shows active subscriber count
- [ ]  Dashboard shows MRR (calculated from subscriptions)
- [ ]  Dashboard shows conversion funnel (signups â†’ activated â†’ converted)
- [ ]  User list with search and filter
- [ ]  User detail shows progress, subscription, emails
- [ ]  Admin can toggle accessOverride for user
- [ ]  Override grants immediate access

### Edge Cases & Error States

- **Large user list:** Pagination required
- **No data yet:** Show zero/empty states gracefully

### ðŸ§ª QA Testing Criteria

**Complexity:** Moderate

**Core Tests:**

- [ ]  View dashboard â†’ Metrics display correctly
- [ ]  Search users â†’ Results match query
- [ ]  Filter by subscription status â†’ Correct users shown
- [ ]  View user detail â†’ All data displayed
- [ ]  Toggle access override ON â†’ User gains access
- [ ]  Toggle access override OFF â†’ User loses access (if no subscription)

**Edge Cases:**

- [ ]  User with no subscription or progress â†’ Shows empty states
- [ ]  MRR calculation with mixed plans â†’ Correct math

---

## Module 8: Polish & Launch

**Core Problem:** Final QA, error handling, and launch readiness.

**Dependencies:** All above modules

**Estimated Effort:** 1-2 days

### Key Flows

- Full user journey test: signup â†’ onboarding â†’ Video 1 â†’ subscribe â†’ progress â†’ complete
- Error state review across all features
- Performance check
- Production deployment

### Schema Areas

- `Event`: Ensure all 14 events tracking correctly

### What's Included

*From Master Spec 2.7 + Global:*

- Verify all 14 analytics events fire correctly
- Error boundaries and fallback UI
- Loading states throughout
- Mobile responsiveness check
- Production environment setup
- Seed initial course content

### What's NOT Included

- Future features (Phase 2)

### Success Criteria

- [ ]  All 14 events track correctly
- [ ]  No console errors in production
- [ ]  All pages mobile responsive
- [ ]  Error states show user-friendly messages
- [ ]  Loading states present where needed
- [ ]  Production deployment successful
- [ ]  Initial course content seeded

### Edge Cases & Error States

- All edge cases from previous modules verified

### ðŸ§ª QA Testing Criteria

**Complexity:** Simple (but thorough)

**Core Tests:**

- [ ]  Full happy path: signup â†’ course complete
- [ ]  Full payment path: subscribe â†’ cancel â†’ resubscribe
- [ ]  Admin path: manage content â†’ manage users â†’ view analytics
- [ ]  Mobile: All flows work on mobile viewport

---

## Risk Notes

| Risk | Why It Matters | Mitigation |
| --- | --- | --- |
| **Stripe webhook reliability** | Missed webhooks = broken subscriptions | Implement retry logic, webhook signature verification, idempotent handlers |
| **Mux upload failures** | Large videos may timeout | Use direct upload, show progress, handle failures gracefully |
| **Email deliverability** | Emails hitting spam | Verify Mailgun domain, use proper from address, test with major providers |
| **Module gating complexity** | Edge cases in progression | Thorough QA of all unlock scenarios |
| **TipTap content migration** | Content format changes | Store as JSON, version content schema if needed |

---

**Next Step:** Review Module Briefs â†’ Generate Build Chunks